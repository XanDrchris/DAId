(()=>{(async function(){async function a(a){let b=await window.showSaveFilePicker({suggestedName:a,types:[{description:"Image",accept:{"Image/*":[".png"]}}]});return b}function b(a,b){fetch(b).then(c=>{URL.revokeObjectURL(b),a.createWritable().then(async a=>{await c.body.pipeTo(a)})})}function c(c){const d=tf.tidy(()=>{let a=tf.browser.fromPixels(c),b=tf.image.resizeBilinear(a,[512,512]),d=tf.sub(tf.div(tf.expandDims(b),127.5),1),f=e.predict(d);return tf.mul(tf.add(f,1),127.5)}),f=Array.from(d.dataSync()),g=[];for(let a=0;a<f.length/3;a++){for(let b=0;3>b;b++)g.push(f[3*a+b]);g.push(255)}const j=new ImageData(Uint8ClampedArray.from(g),512,512),k=c.height/c.width,l=document.createElement("canvas");l.width=512,l.height=512;const n=l.getContext("2d");n.putImageData(j,0,0),l.toBlob(c=>{let d=URL.createObjectURL(c),e=new Image(512,512*k);e.src=d,e.onload=()=>{p||(p=document.createElement("canvas"),q=p.getContext("2d"),m.parentElement.insertBefore(p,m)),m.classList.add("hidden"),p.classList.remove("hidden"),p.width=512,p.height=512*k,q.drawImage(e,0,0,512,512*k),URL.revokeObjectURL(d),h.disabled=!1,i.classList.remove("hidden"),i.addEventListener("click",()=>{p.toBlob(async c=>{let d=URL.createObjectURL(c),e=new Date,f=`AnimeGANv3_${r}-prediction-${e.getTime()}.png`,g=await a(f);b(g,d)})})}})}const d={types:[{description:"Images",accept:{"image/*":[".png",".jpg",".jpeg"]}}],excludeAcceptAllOptions:!0,multiple:!1};let e,f=document.querySelectorAll(".modelGridSec"),g=document.querySelector("#openFile"),h=document.querySelector("#genBtn"),i=document.querySelector("#dwnBtn"),j=document.querySelector("#imgCnt"),k=document.querySelector("#loadModel"),l=document.querySelector("#dwnMes"),m=document.querySelector("#cnvCnt"),n="<p>Image generation time will depend on your device performance.</p>";m.innerHTML=n;let o,p,q,r;f.forEach(a=>{a.addEventListener("click",()=>{a.children[0].checked=!0,r=a.children[0].getAttribute("model"),k.disabled=!1})}),k.addEventListener("click",()=>{let a=new Promise(a=>{l.classList.remove("hidden"),k.classList.add("hidden"),setTimeout(()=>{a()},500)});a.then(()=>{tflite.loadTFLiteModel(`./AnimeGAN-v3/models/AnimeGANv3_${r}.tflite`).then(a=>{e=a,l.innerHTML="Model Loaded",setTimeout(()=>{l.classList.add("hidden"),k.classList.remove("hidden"),l.innerHTML="Downloading Model..."},2e3)})})}),g.addEventListener("click",async()=>{try{r?window.showOpenFilePicker(d).then(async a=>{a[0].getFile().then(a=>{let b=URL.createObjectURL(a);o||(j.innerHTML="",o=new Image,j.appendChild(o),o.style.position="absolute"),o.src=b,o.onload=()=>{let a=o.width/o.height;if(a<4/3){let a=(j.clientHeight-10)/o.height;o.style.zoom=a}else{let a=(j.clientWidth-10)/o.width;o.style.zoom=a}i.classList.add("hidden"),h.disabled=!1,h.addEventListener("click",()=>{let a=new Promise(a=>{h.disabled=!0,m.innerHTML=n+"<p>Running Model...</p>",p&&(m.classList.remove("hidden"),p.classList.add("hidden"),q.clearRect(0,0,p.width,p.height));setTimeout(()=>{a()},1e3)});a.then(()=>{c(o)})}),URL.revokeObjectURL(b)}})}):window.alert("Load Model First!!!")}catch(a){console.error(a)}})})()})();